<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendrier de Garde Altern√©e</title>
    <style>
        /* Style CSS */
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            padding: 20px;
            background-color: #f4f7f6;
        }

        .calendar-container {
            width: 100%;
            max-width: 900px; /* L√©g√®rement plus large pour la configuration */
            background-color: #fff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            padding: 20px;
        }

        /* Conteneurs de configuration */
        .config-header {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background-color: #e9ecef;
        }
        
        /* Configuration des noms et cycle standard */
        .standard-config {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 15px;
        }

        /* Configuration des vacances */
        .holiday-input-group {
            display: flex;
            gap: 10px;
            align-items: flex-end;
            margin-top: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dashed #ccc;
        }
        
        .holiday-input-group > div {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }
        
        .holiday-list-item {
            padding: 5px 0;
            border-bottom: 1px dotted #eee;
        }

        .config-header label {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }

        .config-header input[type="date"], 
        .config-header input[type="text"], 
        .config-header select {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            width: 100%;
            box-sizing: border-box;
        }
        
        .config-header button {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            white-space: nowrap;
        }

        /* En-t√™te du calendrier */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px 0;
            border-bottom: 2px solid #3498db;
        }

        .calendar-header button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 16px;
        }

        .calendar-header h2 {
            margin: 0;
            color: #333;
        }

        /* Tableau du calendrier */
        #calendar {
            width: 100%;
            border-collapse: collapse;
        }

        #calendar th {
            background-color: #3498db;
            color: white;
            padding: 10px;
            font-weight: bold;
        }

        #calendar td {
            border: 1px solid #eee;
            padding: 10px 5px;
            text-align: center;
            height: 60px; /* Espace pour la couleur */
            cursor: default;
            transition: background-color 0.2s;
            position: relative; /* Pour le titre/tooltip */
        }
        
        /* Couleurs d'alternance standard (Parent A/B) */
        .parent-a {
            background-color: #add8e6; /* Bleu clair */
            color: #333;
        }

        .parent-b {
            background-color: #90ee90; /* Vert clair */
            color: #333;
        }
        
        /* Couleurs de Vacances (V: Vacances) - Override standard */
        .v-parent-a {
            background-color: #f7a9a8; /* Rouge ros√© */
            border: 2px dashed #e74c3c;
            font-weight: bold;
        }

        .v-parent-b {
            background-color: #a8d5f7; /* Bleu ciel */
            border: 2px dashed #3498db;
            font-weight: bold;
        }

        /* Jours hors mois */
        .out-of-month {
            background-color: #f8f8f8;
            color: #ccc;
        }

        /* L√©gende */
        .legend {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #ddd;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
        }

        .color-box {
            width: 20px;
            height: 20px;
            margin-right: 8px;
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>

    <div class="calendar-container">
        <h1 style="text-align: center; color: #3498db;">üóìÔ∏è Calendrier de Garde Altern√©e</h1>
        
        <div class="config-header">
            <h3>Configuration Standard</h3>
            <div class="standard-config">
                <div>
                    <label for="nameA">Nom du Parent A :</label>
                    <input type="text" id="nameA" value="Maman" onchange="updateNames()">
                </div>
                <div>
                    <label for="nameB">Nom du Parent B :</label>
                    <input type="text" id="nameB" value="Papa" onchange="updateNames()">
                </div>
                <div>
                    <label for="refDate">Date de d√©but du cycle (Lundi) :</label>
                    <input type="date" id="refDate" value="2025-01-06" onchange="initCalendar()">
                </div>
            </div>
            <label for="startParent">Parent qui commence le cycle standard :</label>
            <select id="startParent" onchange="initCalendar()" style="width: auto;">
                <option value="parent-a" id="opt-parent-a">Maman</option>
                <option value="parent-b" id="opt-parent-b">Papa</option>
            </select>
        </div>

        <div class="config-header" id="holiday-config">
            <h3>Remplacement des P√©riodes de Vacances (50/50)</h3>
            <div class="holiday-input-group">
                <div>
                    <label for="holiday-start">D√©but (inclus) :</label>
                    <input type="date" id="holiday-start">
                </div>
                <div>
                    <label for="holiday-end">Fin (inclus) :</label>
                    <input type="date" id="holiday-end">
                </div>
                <div>
                    <label for="holiday-parent">Garde 1√®re moiti√© :</label>
                    <select id="holiday-parent">
                        <option value="parent-a">Parent A</option>
                        <option value="parent-b">Parent B</option>
                    </select>
                </div>
                <button onclick="addHoliday()" style="background-color: #2ecc71; color: white;">Ajouter</button>
            </div>
            
            <div id="holiday-list">
                <p>Aucune p√©riode de vacances d√©finie.</p>
            </div>
        </div>

        <div class="calendar-header">
            <button id="prev-month" onclick="changeMonth(-1)"> &lt; Mois Pr√©c√©dent </button>
            <h2 id="month-year"></h2>
            <button id="next-month" onclick="changeMonth(1)"> Mois Suivant &gt; </button>
        </div>

        <table id="calendar">
            <thead>
                <tr>
                    <th>Lun</th>
                    <th>Mar</th>
                    <th>Mer</th>
                    <th>Jeu</th>
                    <th>Ven</th>
                    <th>Sam</th>
                    <th>Dim</th>
                </tr>
            </thead>
            <tbody id="calendar-body">
                </tbody>
        </table>

        <div class="legend">
            <div class="legend-item">
                <div class="color-box parent-a"></div>
                <span id="legend-name-a">Parent A (standard)</span>
            </div>
            <div class="legend-item">
                <div class="color-box parent-b"></div>
                <span id="legend-name-b">Parent B (standard)</span>
            </div>
            <div class="legend-item">
                <div class="color-box v-parent-a"></div>
                <span id="legend-vac-a">Parent A (vacances)</span>
            </div>
            <div class="legend-item">
                <div class="color-box v-parent-b"></div>
                <span id="legend-vac-b">Parent B (vacances)</span>
            </div>
        </div>
    </div>

    <script>
        // üß† Logique JavaScript
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        const MS_PER_DAY = 1000 * 60 * 60 * 24;

        // NOUVEAU: Tableau pour stocker les p√©riodes de vacances
        let holidays = []; 
        
        // --- LOGIQUE DE GARDE STANDARD (CYCLE 14 JOURS) ---
        /**
         * D√©termine √† quel parent appartient la date donn√©e, SANS tenir compte des vacances.
         * @returns {{class: string, name: string}} La classe CSS et le nom du parent.
         */
        function getStandardCycleParent(date, refDate, startParentClass) {
            const nameA = document.getElementById('nameA').value || 'Parent A';
            const nameB = document.getElementById('nameB').value || 'Parent B';
            
            // Calculer la diff√©rence en millisecondes, puis en jours
            const diffDays = Math.floor((date.getTime() - refDate.getTime()) / MS_PER_DAY);
            let dayInCycle = diffDays % 14; 
            
            // Assurer que le r√©sultat est positif pour les dates ant√©rieures √† REF_DATE
            if (dayInCycle < 0) {
                dayInCycle += 14;
            }

            // D√©terminer la classe de base (Parent A = jours 0 √† 6, Parent B = jours 7 √† 13)
            let baseInfo = (dayInCycle >= 0 && dayInCycle <= 6) ? 
                { class: 'parent-a', name: nameA } : 
                { class: 'parent-b', name: nameB };

            // Inversion si le parent B commence
            if (startParentClass === 'parent-b') {
                if (baseInfo.class === 'parent-a') {
                    return { class: 'parent-b', name: nameB };
                } else {
                    return { class: 'parent-a', name: nameA };
                }
            }

            return baseInfo;
        }
        
        // --- LOGIQUE DE D√âTECTION ET D'OVERRIDE DE VACANCES ---
        
        /**
         * V√©rifie si la date tombe dans une p√©riode de vacances et retourne l'override.
         * @param {Date} date - La date √† v√©rifier.
         * @returns {{class: string, name: string} | null} L'override si trouv√©, sinon null.
         */
        function getHolidayOverride(date) {
            // Cr√©er une date sans l'heure pour une comparaison propre
            const dateOnly = new Date(date.getFullYear(), date.getMonth(), date.getDate());

            for (const h of holidays) {
                const startTimestamp = h.start.getTime();
                const endTimestamp = h.end.getTime();
                const midTimestamp = h.mid.getTime();
                const dateTimestamp = dateOnly.getTime();

                if (dateTimestamp >= startTimestamp && dateTimestamp <= endTimestamp) {
                    // P√©riode de vacances trouv√©e
                    let parentClass;
                    let parentName;

                    // D√©finir les noms bas√©s sur la config actuelle
                    const nameA = document.getElementById('nameA').value || 'Parent A';
                    const nameB = document.getElementById('nameB').value || 'Parent B';
                    
                    const firstParentName = (h.firstHalfParent === 'parent-a' ? nameA : nameB);
                    const secondParentName = (h.firstHalfParent === 'parent-a' ? nameB : nameA);
                    
                    // D√©terminer le parent pour ce jour sp√©cifique (split 50/50)
                    if (dateTimestamp < midTimestamp) {
                        // Premi√®re moiti√©
                        parentClass = h.firstHalfParent;
                        parentName = firstParentName + " (Vacances 1/2)";
                    } else {
                        // Deuxi√®me moiti√©
                        parentClass = (h.firstHalfParent === 'parent-a' ? 'parent-b' : 'parent-a');
                        parentName = secondParentName + " (Vacances 2/2)";
                    }

                    // Retourner l'override
                    return { 
                        class: 'v-' + parentClass, // Utiliser la classe visuelle de vacances
                        name: parentName,
                        isHoliday: true
                    };
                }
            }

            return null; // Aucune p√©riode de vacances trouv√©e
        }
        
        /**
         * Fonction principale de d√©termination du parent (inclut l'override des vacances).
         */
        function getParent(date, refDate, startParentClass) {
            // 1. Priorit√© aux vacances
            const holidayOverride = getHolidayOverride(date);
            if (holidayOverride) {
                return holidayOverride;
            }
            
            // 2. Si pas de vacances, cycle standard
            return getStandardCycleParent(date, refDate, startParentClass);
        }
        
        // --- FONCTIONS DE GESTION DE LA CONFIGURATION ---

        /**
         * Ajoute une nouvelle p√©riode de vacances √† la liste.
         */
        function addHoliday() {
            const startInput = document.getElementById('holiday-start');
            const endInput = document.getElementById('holiday-end');
            const parentInput = document.getElementById('holiday-parent');

            // Ajout de 'T00:00:00' pour s'assurer que les dates sont au d√©but du jour
            const startDate = new Date(startInput.value + 'T00:00:00');
            const endDate = new Date(endInput.value + 'T00:00:00');
            const firstHalfParent = parentInput.value;

            if (!startInput.value || !endInput.value || startDate > endDate) {
                alert("Veuillez saisir des dates de d√©but et de fin valides (D√©but <= Fin).");
                return;
            }
            
            // Calcul de la date de s√©paration 50/50
            const durationDays = Math.floor((endDate.getTime() - startDate.getTime()) / MS_PER_DAY) + 1;
            const midDayOffset = Math.ceil(durationDays / 2); // Ex: 14 jours -> 7. 1er moiti√© = 7 jours
            
            // midDate est le premier jour de la 2√®me moiti√© de vacances
            const midDate = new Date(startDate.getTime() + (midDayOffset) * MS_PER_DAY);

            holidays.push({
                start: startDate,
                end: endDate,
                mid: midDate,
                firstHalfParent: firstHalfParent,
                id: Date.now()
            });

            startInput.value = '';
            endInput.value = '';
            
            renderHolidayList();
            renderCalendar();
        }

        /**
         * Supprime une p√©riode de vacances par ID.
         */
        function removeHoliday(id) {
            holidays = holidays.filter(h => h.id !== id);
            renderHolidayList();
            renderCalendar();
        }

        /**
         * Met √† jour la liste affich√©e des p√©riodes de vacances.
         */
        function renderHolidayList() {
            const listDiv = document.getElementById('holiday-list');
            listDiv.innerHTML = '';

            if (holidays.length === 0) {
                 listDiv.innerHTML = '<p>Aucune p√©riode de vacances d√©finie.</p>';
                 return;
            }

            holidays.sort((a, b) => a.start - b.start).forEach(h => {
                const startStr = h.start.toLocaleDateString('fr-FR');
                const endStr = h.end.toLocaleDateString('fr-FR');
                // Le jour avant la mi-date est la fin de la 1√®re moiti√©
                const endHalf1 = new Date(h.mid.getTime() - MS_PER_DAY).toLocaleDateString('fr-FR');
                
                const parentName1 = (h.firstHalfParent === 'parent-a' ? document.getElementById('nameA').value : document.getElementById('nameB').value) || 'Parent 1';
                const parentName2 = (h.firstHalfParent === 'parent-a' ? document.getElementById('nameB').value : document.getElementById('nameA').value) || 'Parent 2';

                const item = document.createElement('p');
                item.classList.add('holiday-list-item');
                item.innerHTML = `
                    <span style="font-weight: bold;">${startStr}</span> au <span style="font-weight: bold;">${endStr}</span> : 
                    ${parentName1} jusqu'au ${endHalf1}, puis 
                    ${parentName2} √† partir du ${h.mid.toLocaleDateString('fr-FR')}.
                    <button onclick="removeHoliday(${h.id})" style="margin-left: 10px; color: #e74c3c; border: none; background: none; cursor: pointer; font-size: 14px;">(X)</button>
                `;
                listDiv.appendChild(item);
            });
        }
        
        /**
         * Met √† jour les noms des parents dans la l√©gende et le s√©lecteur de d√©part.
         */
        function updateNames() {
            const nameA = document.getElementById('nameA').value || 'Parent A';
            const nameB = document.getElementById('nameB').value || 'Parent B';
            
            // Mettre √† jour la l√©gende standard
            document.getElementById('legend-name-a').textContent = `${nameA} (standard)`;
            document.getElementById('legend-name-b').textContent = `${nameB} (standard)`;
            
            // Mettre √† jour la l√©gende de vacances
            document.getElementById('legend-vac-a').textContent = `${nameA} (vacances)`;
            document.getElementById('legend-vac-b').textContent = `${nameB} (vacances)`;

            // Mettre √† jour le s√©lecteur du parent qui commence
            document.getElementById('opt-parent-a').textContent = nameA;
            document.getElementById('opt-parent-b').textContent = nameB;

            // NOUVEAU: Mettre √† jour la liste des vacances (pour les noms)
            renderHolidayList();

            // Rafra√Æchir le calendrier
            renderCalendar();
        }


        // --- LOGIQUE D'AFFICHAGE DU CALENDRIER ---

        /**
         * G√©n√®re et affiche le calendrier pour le mois et l'ann√©e courants.
         */
        function renderCalendar() {
            const body = document.getElementById('calendar-body');
            const monthYearText = document.getElementById('month-year');
            const refDateInput = document.getElementById('refDate');
            const startParentSelect = document.getElementById('startParent');

            // 1. R√©cup√©ration de la configuration
            const refDate = new Date(refDateInput.value + 'T00:00:00'); // S'assurer qu'on utilise 00:00:00
            const startParentClass = startParentSelect.value;
            
            // 2. Initialisation des dates du mois
            const firstDayOfMonth = new Date(currentYear, currentMonth, 1);
            const lastDayOfMonth = new Date(currentYear, currentMonth + 1, 0);
            
            // Calcul du d√©calage pour que la semaine commence le Lundi (1) et non Dimanche (0)
            let startOffset = firstDayOfMonth.getDay(); 
            if (startOffset === 0) startOffset = 7; 
            startOffset = startOffset - 1; 

            // Mise √† jour de l'affichage de l'en-t√™te
            const monthName = firstDayOfMonth.toLocaleDateString('fr-FR', { month: 'long' });
            monthYearText.textContent = `${monthName.charAt(0).toUpperCase() + monthName.slice(1)} ${currentYear}`;
            
            body.innerHTML = ''; // Nettoyer l'ancien contenu

            // 3. Boucle de g√©n√©ration des jours
            let date = 1;
            for (let i = 0; i < 6; i++) { // Max 6 semaines
                const row = document.createElement('tr');
                let hasRealDay = false; 

                for (let j = 0; j < 7; j++) { // 7 jours de la semaine
                    const cell = document.createElement('td');
                    cell.className = ''; // R√©initialiser les classes

                    if (i === 0 && j < startOffset) {
                        // Jours du mois pr√©c√©dent
                        cell.classList.add('out-of-month');
                    } else if (date > lastDayOfMonth.getDate()) {
                        // Jours du mois suivant
                        cell.classList.add('out-of-month');
                    } else {
                        // Jours du mois actuel
                        const currentDate = new Date(currentYear, currentMonth, date);
                        
                        // --- APPLICATION DE LA LOGIQUE DE GARDE ALTERN√âE (incluant vacances) ---
                        const parentInfo = getParent(currentDate, refDate, startParentClass);
                        
                        cell.textContent = date;
                        cell.classList.add(parentInfo.class);
                        cell.setAttribute('title', parentInfo.name); 
                        // ---------------------------------------------------------------------
                        
                        date++;
                        hasRealDay = true;
                    }
                    row.appendChild(cell);
                }
                
                if (hasRealDay) {
                    body.appendChild(row);
                }
                
                if (date > lastDayOfMonth.getDate()) {
                    break;
                }
            }
        }

        /**
         * Change le mois affich√© et rafra√Æchit le calendrier.
         */
        function changeMonth(delta) {
            currentMonth += delta;
            
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            } else if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            
            renderCalendar();
        }

        /**
         * Initialise le calendrier au chargement de la page.
         */
        function initCalendar() {
            // 1. Initialiser l'affichage des noms et de la liste de vacances
            updateNames(); 
            
            // 2. Initialiser le calendrier sur le mois actuel
            const today = new Date();
            currentMonth = today.getMonth();
            currentYear = today.getFullYear();
            renderCalendar();
        }

        // D√©marrer le calendrier
        initCalendar();
    </script>

</body>
</html>
